<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Business Logic Vulnerabilities</title>
  <link rel="stylesheet" href="/static/style.css">

</head>
<body>
<header id="title-block-header">
</header>
<h1 id="business-logic-vulnerabilities">Business Logic
Vulnerabilities</h1>
<h2 id="summary">Summary</h2>
<ul>
<li><p><a href="#recon">General Recon for Business Logic
Vulnerabilities</a></p></li>
<li><p><a href="#cheat-sheet">Portswigger Labs Cheat Sheet /
Payloads</a></p></li>
</ul>
<p><br></p>
<h2 id="resources">Resources</h2>
<ul>
<li><p>https://portswigger.net/web-security/logic-flaws</p></li>
<li><p>https://owasp.org/www-project-web-security-testing-guide/v42/4-Web_Application_Security_Testing/10-Business_Logic_Testing/README</p></li>
<li><p>https://owasp.org/www-community/vulnerabilities/Business_logic_vulnerability</p></li>
</ul>
<p><br></p>
<h2 id="recon">Recon</h2>
<ul>
<li><p>Logic flaw vulnerabilities are different than other
vulnerabilities such as SQL Injection, there isn’t a common signature to
identify Logic Flaws, as there is for SQLi.</p></li>
<li><p>It requires walking through the entire application and all it’s
functionalities and determine if there is a defect in the logic that was
implemented in the application.</p></li>
<li><p>Generally, a programmer may have reasoned, “If A happens, then B
must be the case, so I will do C.” But there wasn’t any consideration
for, “But what if X occurs?”.</p></li>
<li><p>There are 12 different Logic Flaw examples on the Web Hacker’s
Handbook 2, that shows some real-world examples where logic flaws can
happen. An overview of some of those examples will be below.</p></li>
</ul>
<p><br></p>
<h3 id="logic-flaw-examples-concepts">Logic Flaw Examples /
Concepts</h3>
<ul>
<li><p>Remove parameters/cookies/query strings in each of the requests
one at a time and analyze the responses. This ensures that all relevant
code paths within the application are reached.</p></li>
<li><p>In multistage processes attempt to “force browse” and submit
requests in different orders and analyze the responses. Think of the
assumptions that may have been made.</p></li>
<li><p>In a funds transfer application for example, try submitting
negative values or very large values. Analyze the affects it has on the
application.</p></li>
<li><p>In any situation where sensitive values are adjusted based on
user controllable criteria, analyze if this is a one-time process or if
these values change based on further actions by the user.</p>
<ul>
<li>Example: Getting a discount after a minimum total is reached, then
removing items to lower that amount, while still using the discount</li>
</ul></li>
<li><p>Sometimes an escape character is used to escape malicious
characters to protect against certain vulnerabilities such as command
injection. We can inject our own escape character  to neutralize the
escape character that is used for defense.</p>
<ul>
<li>For example, injecting the following payload ( ; ls ) results in (
\; ls ).<br />
</li>
<li>However, if we inject the following payload ( \; ls ) then the
application will still insert an escape character, but it will be
neutralized ( \\; ls ).</li>
</ul></li>
<li><p>Identify any instances where the application either truncates,
strips out, encodes or decodes user supplied data. Determine if
malicious strings can be derived.</p></li>
<li><p>Identify cases where the application is storing information in a
static manner as opposed to per-thread/per-session based.</p>
<ul>
<li>Examples: There is an endpoint that holds error messages that
contain user info (not session based), so a user can potentially see
details for another user. Race conditions in login functionalities,
where static values are used to determine the user in the backend, so
its possible for a user to see another user’s data upon logging in.</li>
</ul></li>
</ul>
<p><br></p>
<p><br></p>
<h2 id="cheat-sheet">Cheat Sheet</h2>
<p><br></p>
<h3
id="excessive-trust-in-client-side-controls-and-high-level-logic-flaw">Excessive
trust in client-side controls and High-level logic flaw</h3>
<ul>
<li><p>Use a Web Proxy to bypass any client-side restrictions
implemented on the application. We can change the values for critical
parameters and potentially break the logic of the application.</p>
<ul>
<li><p>For example, changing the price of an item on our shopping cart
to an arbitrary value.</p></li>
<li><p>Another example, change the quantity value of an item purchased
to a negative number, which may bring the total price of our shopping
cart order down.</p></li>
</ul></li>
</ul>
<p><br><br></p>
<h3 id="low-level-logic-flaw">Low-level logic flaw</h3>
<ul>
<li><p>Manipulate a numeric input field so that its value reaches a very
large number. Analyze how the application responds, maybe there is a
limit and once it is reached, it may be reverted back to zero or a
negative number. Depending on the context, this logic flaw can be very
critical.</p>
<ul>
<li>For example, if the total price of a shopping cart reverts back to 0
then this can be bad for the application/company.</li>
</ul></li>
</ul>
<p><br><br></p>
<h3 id="inconsistent-handling-of-exceptional-input">Inconsistent
handling of exceptional input</h3>
<ul>
<li><p>Similar to the previous point, by submitting a very large value
to an input field, the application may truncate the value to a certain
character size limit. Depending on the context this can be used to
bypass some restrictions on the application.</p></li>
<li><p>When using the Exploit Server in the labs, this is an example of
the submitted payload for the email client:</p>
<ul>
<li><p>GGGGGG@dontwannacry.com.exploit-0af9002f03ad294781cd9cd301d3009d.exploit-server.net</p></li>
<li><p>For example, if the application allows users to register an
account try to submit a very large value for the email address. The
application may truncate the email after confirmation and set it as
GGGGGG@dontwannacry.com in the application.</p></li>
</ul></li>
</ul>
<p><br><br></p>
<h3 id="inconsistent-security-controls">Inconsistent security
controls</h3>
<ul>
<li>After registering an account on an application. Identify if there
are any “Update email” functionality available. Use this functionality
and identify if the application requires verification on the new email
address specified before fully updating our email address. If it does
not, then we can update our email to an arbitrary value and potential
bypass some access controls.</li>
</ul>
<p><br><br></p>
<h3 id="weak-isolation-on-dual-use-endpoint">Weak isolation on dual-use
endpoint</h3>
<ul>
<li><p>Remove parameters completely from requests and analyze how the
application responds. This can potentially bypass some restrictions or
logic that the application is using.</p>
<ul>
<li>For example, in a “change password” functionality, remove the
“current-password” parameter if there is one.</li>
</ul></li>
</ul>
<p><br><br></p>
<h3
id="insufficient-workflow-validation-and-authentication-bypass-via-flawed-state-machine">Insufficient
workflow validation and Authentication bypass via flawed state
machine</h3>
<ul>
<li><p>When going through a workflow/functionality, skip a step and see
how the application responds. We may be able to bypass a critical step
in the process.</p>
<ul>
<li><p>For example, in a “Cart checkout” workflow, skip the “checkout”
step and go straight to the “order confirmation” step.</p></li>
<li><p>Another example, if after logging into an application you must
select a “role”. Drop all of the requests after logging into the
application and analyze how the application responds, we may be able to
bypass some access control related functions, since our “role” was never
selected. This is essentially a “force browse” bypass.</p></li>
</ul></li>
</ul>
<p><br><br></p>
<h3 id="flawed-enforcement-of-business-rules">Flawed enforcement of
business rules</h3>
<ul>
<li>If the application has 2 coupons that can be used to get a discount
on an order, but these coupons should only be allowed to use once per
order, try submitting them one after another in the same purchase order
and analyze how the application responds. This may bypass some flawed
logic on the application.</li>
</ul>
<p><br><br></p>
<h3 id="infinite-money-logic-flaw">Infinite money logic flaw</h3>
<ul>
<li><p>If the application offers a coupon code that can be used when
submitting an order, check if this coupon can be used an infinite number
of times once per order.</p>
<ul>
<li>For example, we can purchase a gift card and use the coupon code
when purchasing it, and when redeeming the gift card, we earn a profit.
An “Infinite money logic flaw” can be exploited here, if the coupon can
be used many times. If using Burp Intruder, the Max Concurrent Requests
configuration should be set to 1, as the order of the requests will be
important. See lab/document details.</li>
</ul></li>
</ul>
<p><br><br></p>
<h3 id="authentication-bypass-via-encryption-oracle">Authentication
bypass via encryption oracle</h3>
<ul>
<li>One last example not discussed here (see lab) - <a
href="https://portswigger.net/web-security/logic-flaws/examples/lab-logic-flaws-authentication-bypass-via-encryption-oracle">Encryption
Oracle</a></li>
</ul>
<p><br><br><br></p>
<h3
id="pending-to-complete-labs-that-are-missing-from-cheat-sheet">Pending
to complete labs that are missing from cheat sheet:</h3>
<ul>
<li>All labs in this category are completed and referenced in cheat
sheet.</li>
</ul>
</body>
</html>
